import{j as e}from"./ui-DgCwhHkT.js";import{r as a}from"./react-C14kkwO6.js";import{a as U,b as Y,c as z}from"./index-CFOCruvU.js";import{f as G}from"./calendarService-BJQaKnXb.js";import{f as K}from"./sheetMusicService-C-r0DAeS.js";import{P as Q}from"./PageTransition-BFnjTUrs.js";import{C as J,r as X,L as ee,B as te,t as ae,u as se,v as re,w as ne}from"./data-2de0kleH.js";import"./supabase-D5PNQMqt.js";function oe({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941"}))}const ie=a.forwardRef(oe);function le({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"}))}const ce=a.forwardRef(le);function de({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))}const k=a.forwardRef(de);function me({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const C=a.forwardRef(me);function ue({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const he=a.forwardRef(ue);function ge({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const xe=a.forwardRef(ge);function we({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const b=a.forwardRef(we);function fe({title:t,titleId:s,...o},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},o),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z"}))}const S=a.forwardRef(fe);J.register(X,ee,te,ae,se,re);const N=[{value:"current_week",label:"This Week",days:0,icon:b},{value:"week",label:"Last Week",days:7,icon:ce},{value:"month",label:"Last Month",days:30,icon:k},{value:"quarter",label:"Last Quarter",days:90,icon:ie},{value:"year",label:"Last Year",days:365,icon:b},{value:"all",label:"All Time",days:1/0,icon:C}],M=t=>{const s=new Date;switch(t){case"current_week":{const o=s.getDay(),n=new Date(s);return n.setDate(s.getDate()-o),n.setHours(0,0,0,0),n}case"week":{const o=s.getDay(),n=new Date(s);return n.setDate(s.getDate()-o-7),n.setHours(0,0,0,0),n}case"all":return new Date(0);default:{const o=N.find(y=>y.value===t),n=new Date(s);return n.setDate(n.getDate()-o.days),n}}},L="dashboard_time_period",Ee=()=>{const{isDarkMode:t}=U(),{user:s}=Y(),{showToast:o}=z(),[n,y]=a.useState([]),[ve,P]=a.useState([]),[A,T]=a.useState(!0),[d,R]=a.useState(()=>localStorage.getItem(L)||"month"),[j,E]=a.useState(!1),[w,Z]=a.useState({totalPracticeTime:0,completedSessions:0,totalSessions:0,averageSessionDuration:0,recentPieces:[]}),[$,O]=a.useState({labels:[],data:[]}),B=r=>{const c=new Date,h=M(d),i=r.filter(u=>new Date(u.startTime)>=h&&new Date(u.startTime)<=c&&u.isCompleted),m=new Map;i.forEach(u=>{const x=new Date(u.startTime).toLocaleDateString("en-US",{month:"short",day:"numeric"}),D=(new Date(u.endTime).getTime()-new Date(u.startTime).getTime())/(1e3*60);m.set(x,(m.get(x)||0)+D)});const v=Array.from(m.entries()).sort((u,x)=>new Date(u[0]).getTime()-new Date(x[0]).getTime());O({labels:v.map(([u])=>u),data:v.map(([u,x])=>Math.round(x))})};a.useEffect(()=>{s&&_()},[s,d]);const _=async()=>{if(s)try{T(!0);const[r,c]=await Promise.all([G(s.id),K(s.id)]);y(r),P(c),I(r,c),B(r)}catch(r){console.error("Error loading data:",r),o("Failed to load practice data","error")}finally{T(!1)}},I=(r,c)=>{const h=new Date,i=M(d),m=r.filter(l=>new Date(l.startTime)>=i&&new Date(l.startTime)<=h&&l.isCompleted),v=m.reduce((l,g)=>{const f=(new Date(g.endTime).getTime()-new Date(g.startTime).getTime())/6e4;return l+f},0),u=r.filter(l=>new Date(l.startTime)>=i&&new Date(l.startTime)<=h),x=new Map;m.forEach(l=>{if(l.sheetMusicId){const g=x.get(l.sheetMusicId)||{count:0,lastPracticed:new Date(0)};x.set(l.sheetMusicId,{count:g.count+1,lastPracticed:new Date(l.startTime)>g.lastPracticed?new Date(l.startTime):g.lastPracticed})}});const D=Array.from(x.entries()).map(([l,g])=>{const f=c.find(q=>q.id===l);return f?{id:f.id,title:f.title,composer:f.composer,practiceCount:g.count,lastPracticed:g.lastPracticed}:null}).filter(Boolean).sort((l,g)=>g.lastPracticed.getTime()-l.lastPracticed.getTime()).slice(0,6);Z({totalPracticeTime:Math.round(v),completedSessions:m.length,totalSessions:u.length,averageSessionDuration:m.length>0?Math.round(v/m.length):0,recentPieces:D})},p=({title:r,value:c,icon:h,unit:i="",description:m=""})=>e.jsx("div",{className:`
      p-6 rounded-xl shadow-lg
      ${t?"bg-gray-800":"bg-white"}
      hover:scale-[1.02] transition-transform duration-200
    `,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`
          p-3 rounded-lg
          ${t?"bg-gray-700":"bg-gray-100"}
        `,children:e.jsx(h,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:`
            text-sm font-medium
            ${t?"text-gray-400":"text-gray-500"}
          `,children:r}),e.jsxs("p",{className:`
            text-2xl font-bold
            ${t?"text-white":"text-gray-900"}
          `,children:[c,i]}),m&&e.jsx("p",{className:`
              text-sm mt-1
              ${t?"text-gray-500":"text-gray-400"}
            `,children:m})]})]})}),H=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"}),W=()=>{const r=N.find(i=>i.value===d),c=r.icon,h=i=>{R(i),localStorage.setItem(L,i),E(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>E(!j),className:`
            flex items-center space-x-2 px-4 py-2 rounded-lg
            ${t?"bg-gray-800 hover:bg-gray-700":"bg-white hover:bg-gray-50"}
            shadow transition-colors duration-200
          `,children:[e.jsx(c,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:`
            ${t?"text-gray-300":"text-gray-700"}
          `,children:r.label}),e.jsx(xe,{className:`
            h-4 w-4 transition-transform duration-200
            ${j?"rotate-180":""}
            ${t?"text-gray-400":"text-gray-500"}
          `})]}),j&&e.jsx("div",{className:`
            absolute right-0 mt-2 w-48 rounded-lg shadow-lg
            ${t?"bg-gray-800":"bg-white"}
            border ${t?"border-gray-700":"border-gray-200"}
            overflow-hidden z-10
          `,children:N.map(i=>{const m=i.icon;return e.jsxs("button",{onClick:()=>h(i.value),className:`
                    w-full flex items-center space-x-3 px-4 py-3
                    ${t?"hover:bg-gray-700 text-gray-300":"hover:bg-gray-50 text-gray-700"}
                    transition-colors duration-200
                    ${d===i.value?t?"bg-gray-700":"bg-gray-50":""}
                  `,children:[e.jsx(m,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{children:i.label})]},i.value)})})]})},F={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:r=>{const c=r.raw,h=Math.floor(c/60),i=c%60;return`${h}h ${i}m`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:r=>{const c=r,h=Math.floor(c/60),i=c%60;return`${h}h ${i}m`}}}}},V={labels:$.labels,datasets:[{data:$.data,backgroundColor:t?"rgba(59, 130, 246, 0.5)":"rgba(59, 130, 246, 0.2)",borderColor:"rgb(59, 130, 246)",borderWidth:1,borderRadius:4,hoverBackgroundColor:"rgb(59, 130, 246)"}]};return e.jsx(Q,{children:e.jsx("div",{className:`
        h-full overflow-hidden
        ${t?"bg-gray-900":"bg-gray-100"}
      `,children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:`
              text-3xl font-bold
              ${t?"text-white":"text-gray-900"}
            `,children:"Practice Dashboard"}),e.jsx(W,{})]}),A?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(p,{title:"Total Practice Time",value:w.totalPracticeTime,icon:b,unit:" min",description:`${d==="current_week"?"This week":d==="week"?"Last week":d==="month"?"Last 30 days":d==="quarter"?"Last 90 days":d==="year"?"Last year":"All time"}`}),e.jsx(p,{title:"Completed Sessions",value:w.completedSessions,icon:he,description:`of ${w.totalSessions} total`}),e.jsx(p,{title:"Total Sessions",value:w.totalSessions,icon:k,description:`${d==="current_week"?"This week":d==="week"?"Last week":d==="month"?"Last 30 days":d==="quarter"?"Last 90 days":d==="year"?"Last year":"All time"}`}),e.jsx(p,{title:"Avg. Session Duration",value:w.averageSessionDuration,icon:b,unit:" min",description:"Per session"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:`
                  p-6 rounded-xl shadow-lg
                  ${t?"bg-gray-800":"bg-white"}
                `,children:[e.jsx("h2",{className:`
                    text-xl font-semibold mb-6
                    ${t?"text-white":"text-gray-900"}
                  `,children:"Practice Time Overview"}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{options:F,data:V})})]}),e.jsxs("div",{className:`
                  p-6 rounded-xl shadow-lg
                  ${t?"bg-gray-800":"bg-white"}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:`
                      text-xl font-semibold
                      ${t?"text-white":"text-gray-900"}
                    `,children:"Recently Practiced Pieces"}),e.jsxs("div",{className:`
                      flex items-center space-x-2 px-3 py-1 rounded-lg
                      ${t?"bg-gray-700":"bg-gray-100"}
                    `,children:[e.jsx(S,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:`
                        text-sm
                        ${t?"text-gray-300":"text-gray-600"}
                      `,children:[w.recentPieces.length," pieces"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:w.recentPieces.map(r=>e.jsxs("div",{className:`
                          flex flex-col p-4 rounded-lg
                          ${t?"bg-gray-700":"bg-gray-50"}
                          hover:scale-[1.02] transition-transform duration-200
                        `,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:`
                              font-medium
                              ${t?"text-white":"text-gray-900"}
                            `,children:r.title}),e.jsx("p",{className:`
                              text-sm
                              ${t?"text-gray-400":"text-gray-500"}
                            `,children:r.composer})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("div",{className:`
                            flex items-center space-x-1
                            ${t?"text-gray-400":"text-gray-500"}
                          `,children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:H(r.lastPracticed)})]}),e.jsxs("div",{className:`
                            flex items-center space-x-1
                            ${t?"text-gray-400":"text-gray-500"}
                          `,children:[e.jsx(C,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:[r.practiceCount," ",r.practiceCount===1?"session":"sessions"]})]})]})]},r.id))})]})]})]})]})})})};export{Ee as default};
