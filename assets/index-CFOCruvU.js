const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SheetMusic-DgSqa4IJ.js","assets/ui-DgCwhHkT.js","assets/react-C14kkwO6.js","assets/pdf-BMsdgI1N.js","assets/sheetMusicService-C-r0DAeS.js","assets/useScrollReset-ZRr5ZJk0.js","assets/PageTransition-BFnjTUrs.js","assets/withApiAvailability-ByMhxnoO.js","assets/supabase-D5PNQMqt.js","assets/Practice--rBixyo1.js","assets/Calendar-DXcuL_t6.js","assets/calendarService-BJQaKnXb.js","assets/data-2de0kleH.js","assets/Dashboard-By0BNa38.js","assets/Settings-Dx3rqj6w.js","assets/Documentation-DcHakhWo.js","assets/InfoBox-DNiEcY11.js","assets/KeyboardShortcuts-B6XWdC3d.js","assets/ContactSupport-CHCplAUF.js","assets/PrivacySettings-BRLosjRT.js","assets/SettingRow-C7_uC_dB.js","assets/NotificationSettings-DxkGw9oG.js"])))=>i.map(i=>d[i]);
var F=Object.defineProperty;var U=(r,e,s)=>e in r?F(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var v=(r,e,s)=>U(r,typeof e!="symbol"?e+"":e,s);import{j as t,X as K,M as G,C as J,B as Z,S as B,A as W}from"./ui-DgCwhHkT.js";import{b as X,r as i,d as H,e as I,u as E,N as q,R as Q,H as Y}from"./react-C14kkwO6.js";import{c as ee,_ as m}from"./supabase-D5PNQMqt.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();var j={},P=X;j.createRoot=P.createRoot,j.hydrateRoot=P.hydrateRoot;const te="https://qzyyrynfkvdrdpplnjfu.supabase.co/",re="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6eXlyeW5ma3ZkcmRwcGxuamZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI3NDgyNjQsImV4cCI6MjA1ODMyNDI2NH0.htQm7ZT0XNUN7sWvKDVy9ITzRr78zMzzbKKArhIziZo",se=`${window.location.origin}/partitura/auth/callback`,x=ee(te,re,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",storage:window.localStorage,storageKey:"partitura-auth",debug:!0},global:{headers:{"x-redirect-to":se}}}),z=i.createContext(void 0),oe=({children:r})=>{const[e,s]=i.useState(null),[a,o]=i.useState(!0),[l,n]=i.useState(null);i.useEffect(()=>{x.auth.getSession().then(({data:{session:d}})=>{s((d==null?void 0:d.user)??null),o(!1)});const{data:{subscription:g}}=x.auth.onAuthStateChange((d,f)=>{s((f==null?void 0:f.user)??null),o(!1)});return()=>g.unsubscribe()},[]);const c=async()=>{try{o(!0),n(null);const{data:g,error:d}=await x.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/partitura/auth/callback"}});if(d)throw console.error("Google sign-in error:",d),d;console.log("Google sign-in response:",g)}catch(g){throw console.error("Error signing in with Google:",g),g}},u=async()=>{try{s(null),localStorage.clear(),sessionStorage.clear(),x.auth.signOut().catch(g=>{console.warn("Supabase sign out error:",g)}),window.location.reload()}catch(g){console.error("Error during logout:",g),window.location.reload()}};return t.jsx(z.Provider,{value:{user:e,loading:a,signInWithGoogle:c,logout:u},children:r})},N=()=>{const r=i.useContext(z);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},S="http://localhost:3001/api";class A extends Error{constructor(s,a=0,o=!1){super(s);v(this,"status");v(this,"isConnectionError");this.name="ApiError",this.status=a,this.isConnectionError=o}}const k=async r=>{if(!r.ok){const e=await r.json().catch(()=>null),s=(e==null?void 0:e.error)||(e==null?void 0:e.message)||`API Error: ${r.status} ${r.statusText}`;throw new A(s,r.status)}return r},ae=async(r={})=>{const e=await D();return{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{},...r}},$=async(r,e={})=>{try{const s=`${S}${r}`,a=await ae(e.headers),o=new AbortController,l=setTimeout(()=>o.abort(),1e4),n=await fetch(s,{...e,headers:a,signal:o.signal});return clearTimeout(l),await k(n),n.status===204?null:await n.json()}catch(s){throw console.error("API request failed:",s),s.name==="AbortError"||s.name==="TypeError"||s.message==="Failed to fetch"?new A("Unable to connect to the Partitura API.",0,!0):s}},ke=async(r,e,s={})=>{try{const a=`${S}${r}`,o=await D(),l={...o?{Authorization:`Bearer ${o}`}:{},...s.headers},n=new AbortController,c=setTimeout(()=>n.abort(),3e4),u=await fetch(a,{method:"POST",body:e,...s,headers:l,signal:n.signal});return clearTimeout(c),await k(u),await u.json()}catch(a){throw console.error("File upload failed:",a),a.name==="AbortError"||a.name==="TypeError"||a.message==="Failed to fetch"?new A("Unable to connect to the Partitura API.",0,!0):a}},ne=async r=>{try{return await $(`/users/${r}/preferences`)}catch(e){return console.error("Error fetching user preferences:",e),{theme:"light",notifications_enabled:!0}}},ie=async(r,e)=>{try{return await $(`/users/${r}/preferences`,{method:"PUT",body:JSON.stringify(e)})}catch(s){throw console.error("Error updating user preferences:",s),s}},D=async()=>{try{const{data:r,error:e}=await x.auth.getSession();return e||!r.session?(console.error("Error getting auth token:",e),null):r.session.access_token}catch(r){return console.error("Error getting auth token:",r),null}},R=i.createContext(void 0),ce=({children:r})=>{const[e,s]=i.useState(()=>window.matchMedia("(prefers-color-scheme: dark)").matches),{user:a}=N();i.useEffect(()=>{(async()=>{if(a)try{const n=await ne(a.id);n&&s(n.theme==="dark")}catch(n){console.error("Theme preference error:",n)}})()},[a]);const o=async()=>{try{const l=!e;a&&await ie(a.id,{theme:l?"dark":"light"}),s(l)}catch(l){console.error("Theme toggle error:",l)}};return i.useEffect(()=>{document.documentElement.classList.toggle("dark",e)},[e]),t.jsx(R.Provider,{value:{isDarkMode:e,toggleTheme:o},children:r})},b=()=>{const r=i.useContext(R);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r},O=i.createContext(void 0),le=({children:r})=>{const[e,s]=i.useState([]),a=(n,c="info")=>{const u=Date.now().toString();s(g=>[...g,{id:u,message:n,type:c}]),setTimeout(()=>{o(u)},5e3)},o=n=>{s(c=>c.filter(u=>u.id!==n))},l=n=>{switch(n){case"success":return"bg-green-500 text-white";case"error":return"bg-red-500 text-white";case"warning":return"bg-yellow-500 text-white";case"info":default:return"bg-blue-500 text-white"}};return t.jsxs(O.Provider,{value:{showToast:a},children:[r,e.length>0&&t.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2",children:e.map(n=>t.jsxs("div",{className:`p-3 rounded-lg shadow-lg flex items-center justify-between min-w-[250px] max-w-sm ${l(n.type)}`,children:[t.jsx("span",{children:n.message}),t.jsx("button",{onClick:()=>o(n.id),className:"ml-2 p-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",children:t.jsx(K,{size:16})})]},n.id))})]})},ue=()=>{const r=i.useContext(O);if(r===void 0)throw new Error("useToast must be used within a ToastProvider");return r},L=i.createContext(void 0),de=({children:r})=>{const[e,s]=i.useState(!0),[a,o]=i.useState(null),[l,n]=i.useState(!1),{showToast:c}=ue(),u=async()=>{try{const f=`${S.split("/api")[0]}/health`,p=new AbortController,w=setTimeout(()=>p.abort(),5e3),V=await fetch(f,{method:"GET",signal:p.signal});clearTimeout(w);const C=V.ok;return s(C),o(new Date),C}catch{return s(!1),o(new Date),!1}},g=async()=>{if(l)return e;n(!0);try{const d=await u();return d?c("API connection restored!","success"):c("API is still unavailable","error"),d}finally{n(!1)}};return i.useEffect(()=>{u();const d=setInterval(()=>{e?a&&new Date().getTime()-a.getTime()>12e4&&u():u().then(f=>{f&&!e&&c("API connection restored!","success")})},3e4);return()=>clearInterval(d)},[e,a]),t.jsx(L.Provider,{value:{isApiAvailable:e,retryConnection:g,lastChecked:a},children:r})},$e=()=>{const r=i.useContext(L);if(r===void 0)throw new Error("useApiStatus must be used within an ApiStatusProvider");return r},he={general:{closeDialog:"Escape",tabNavigation:"Tab"},sheetMusic:{search:"Ctrl + F",addNew:"Ctrl + N"},pdfViewer:{previousPage:"ArrowLeft",nextPage:"ArrowRight",zoomIn:"Ctrl + +",zoomOut:"Ctrl + -",toggleFullscreen:"F"}},M=i.createContext(void 0),h=r=>r.replace(/Control \+/g,"Ctrl +").replace(/Command \+/g,"Cmd +").replace(/Meta \+/g,"Cmd +"),ge=r=>r.toLowerCase().replace(/control \+/g,"ctrl +").replace(/command \+/g,"cmd +").replace(/meta \+/g,"cmd +"),me=({children:r})=>{const[e,s]=i.useState(()=>{const c=localStorage.getItem("shortcuts");if(c){const u=JSON.parse(c);return{general:{closeDialog:h(u.general.closeDialog),tabNavigation:h(u.general.tabNavigation)},sheetMusic:{search:h(u.sheetMusic.search),addNew:h(u.sheetMusic.addNew)},pdfViewer:{previousPage:h(u.pdfViewer.previousPage),nextPage:h(u.pdfViewer.nextPage),zoomIn:h(u.pdfViewer.zoomIn),zoomOut:h(u.pdfViewer.zoomOut),toggleFullscreen:h(u.pdfViewer.toggleFullscreen)}}}return he}),a=i.useCallback((c,u,g)=>{const d=e[u][g];if(!d)return!1;const f=ge(d);let p=[];if((c.ctrlKey||c.metaKey)&&p.push("ctrl"),c.altKey&&p.push("alt"),c.shiftKey&&p.push("shift"),c.key===" ")p.push("space");else{if(c.key==="Control"||c.key==="Alt"||c.key==="Shift"||c.key==="Meta")return!1;p.push(c.key.toLowerCase())}const w=p.join(" + ");return f===w},[e]),o=i.useCallback(c=>{const u={general:{closeDialog:h(c.general.closeDialog),tabNavigation:h(c.general.tabNavigation)},sheetMusic:{search:h(c.sheetMusic.search),addNew:h(c.sheetMusic.addNew)},pdfViewer:{previousPage:h(c.pdfViewer.previousPage),nextPage:h(c.pdfViewer.nextPage),zoomIn:h(c.pdfViewer.zoomIn),zoomOut:h(c.pdfViewer.zoomOut),toggleFullscreen:h(c.pdfViewer.toggleFullscreen)}};s(u),localStorage.setItem("shortcuts",JSON.stringify(u))},[]),l=i.useCallback((c,u)=>e[c][u]||"",[e]),n={shortcuts:e,updateShortcuts:o,getShortcut:l,isShortcutTriggered:a};return t.jsx(M.Provider,{value:n,children:r})},De=()=>{const r=i.useContext(M);if(r===void 0)throw new Error("useShortcuts must be used within a ShortcutProvider");return r},y=({icon:r,text:e,isExpanded:s,isActive:a=!1,onClick:o})=>{const{isDarkMode:l}=b(),n=()=>e==="Settings"?"transition-transform duration-300 group-hover:rotate-180":"transition-transform duration-300 group-hover:scale-125";return t.jsx("li",{children:t.jsxs("button",{onClick:o,className:`
          w-full flex items-center p-3 rounded-lg
          transition-colors duration-200
          focus:outline-none focus:ring-2
          ${l?`${a?"bg-gray-700 text-blue-400":"text-gray-300 hover:bg-gray-700 hover:text-blue-400"} focus:ring-gray-600`:`${a?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-blue-600"} focus:ring-blue-200`}
          group
        `,children:[t.jsx("span",{className:`
          inline-flex justify-center items-center w-8 h-8
          ${n()}
        `,children:r}),s&&t.jsx("span",{className:"ml-3 font-medium",children:e}),!s&&t.jsx("span",{className:"sr-only",children:e})]})})},fe=({currentPage:r,onNavigate:e,isExpanded:s,onExpandedChange:a})=>{const{isDarkMode:o}=b(),l=()=>a(!s);return t.jsxs("aside",{className:`
      ${s?"w-64":"w-20"}
      fixed top-4 left-4 h-[calc(100vh-2rem)] 
      ${o?"bg-gray-800 text-gray-100 border-gray-700":"bg-white text-gray-600 border-gray-200"}
      transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]
      flex flex-col
      rounded-xl shadow-lg
      overflow-hidden
      border
      transform-gpu
    `,children:[t.jsxs("div",{className:`
        flex items-center p-4 cursor-pointer
        ${o?"bg-gray-900 border-gray-700":"bg-gray-50 border-gray-200"}
        border-b
        transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]
        hover:brightness-110
        group
      `,onClick:l,children:[t.jsx("div",{className:`
          flex items-center justify-center
          transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]
          ${s?"w-10":"w-full"}
          transform-gpu
        `,children:t.jsx("img",{src:"/partitura/assets/icon.png",alt:"Partitura Logo",className:`
              w-10 h-10
              transition-all duration-500
              transform-gpu
              group-hover:scale-105
              ${s?"":"rotate-360"}
            `})}),t.jsx("div",{className:`
          overflow-hidden
          transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]
          ${s?"w-40 opacity-100":"w-0 opacity-0"}
        `,children:t.jsx("h1",{className:`
            ml-3 text-xl font-bold whitespace-nowrap
            ${o?"text-gray-100":"text-gray-800"}
          `,children:"Partitura"})})]}),t.jsx("nav",{className:"flex-1 overflow-y-auto",children:t.jsxs("ul",{className:`
          space-y-2 p-4
          transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]
          ${s?"opacity-100":"opacity-80"}
        `,children:[t.jsx(y,{icon:t.jsx(G,{size:24}),text:"Sheet Music",isExpanded:s,isActive:r==="sheet-music",onClick:()=>e("sheet-music")}),t.jsx(y,{icon:t.jsx(J,{size:24}),text:"Calendar",isExpanded:s,isActive:r==="calendar",onClick:()=>e("calendar")}),t.jsx(y,{icon:t.jsx(Z,{size:24}),text:"Dashboard",isExpanded:s,isActive:r==="dashboard",onClick:()=>e("dashboard")})]})}),t.jsx("div",{className:`
        p-4 
        ${o?"bg-gray-900 border-gray-700":"bg-gray-50 border-gray-200"}
        border-t
      `,children:t.jsx("ul",{className:"list-none",children:t.jsx(y,{icon:t.jsx(B,{size:24}),text:"Settings",isExpanded:s,isActive:r==="settings",onClick:()=>e("settings")})})})]})},pe=({children:r,currentPage:e,onNavigate:s,isSidebarExpanded:a,onSidebarExpandedChange:o})=>{const{isDarkMode:l}=b(),n=i.useRef(null);return i.useEffect(()=>{n.current&&(n.current.scrollTop=0)},[e]),t.jsxs("div",{className:`h-screen ${l?"bg-gray-900":"bg-gray-100"}`,children:[t.jsx(fe,{currentPage:e,onNavigate:s,isExpanded:a,onExpandedChange:o}),t.jsx("main",{ref:n,className:`
        transition-all duration-300
        ${a?"ml-72":"ml-28"}
          h-screen overflow-y-auto
        p-8
        `,children:r})]})},xe=()=>{const{signInWithGoogle:r}=N(),{isDarkMode:e}=b();return t.jsx("div",{className:`
      min-h-screen flex items-center justify-center
      ${e?"bg-gray-900":"bg-gray-50"}
      p-4
    `,children:t.jsxs("div",{className:`
        max-w-md w-full space-y-8
        ${e?"bg-gray-800":"bg-white"}
        p-8 rounded-xl shadow-lg
      `,children:[t.jsxs("div",{className:"text-center",children:[t.jsx("img",{src:"/partitura/assets/icon.png",alt:"Partitura Logo",className:"mx-auto h-16 w-16"}),t.jsx("h2",{className:`
            mt-6 text-3xl font-bold
            ${e?"text-gray-100":"text-gray-900"}
          `,children:"Welcome to Partitura"}),t.jsx("p",{className:`mt-2 text-sm ${e?"text-gray-400":"text-gray-600"}`,children:"Sign in to access your sheet music from anywhere"})]}),t.jsx("div",{className:"mt-8",children:t.jsx("button",{onClick:r,className:`
              group relative w-full flex justify-center
              py-3 px-4 rounded-lg text-sm font-medium
              ${e?"bg-white text-gray-900 hover:bg-gray-100":"bg-white text-gray-900 hover:bg-gray-50"}
              border border-gray-300
              focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
              transition-colors duration-200
            `,children:t.jsxs("span",{className:"flex items-center",children:[t.jsx("img",{src:"https://www.google.com/favicon.ico",alt:"Google",className:"w-5 h-5 mr-3"}),"Sign in with Google"]})})}),t.jsx("div",{className:"mt-6 text-center",children:t.jsx("p",{className:`text-sm ${e?"text-gray-400":"text-gray-600"}`,children:"Your sheet music, synchronized across all devices"})})]})})},T=i.lazy(()=>m(()=>import("./SheetMusic-DgSqa4IJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])));i.lazy(()=>m(()=>import("./Practice--rBixyo1.js"),__vite__mapDeps([9,1,2,5,6,8])));const ye=i.lazy(()=>m(()=>import("./Calendar-DXcuL_t6.js"),__vite__mapDeps([10,1,2,11,12,4,6,7,8]))),be=i.lazy(()=>m(()=>import("./Dashboard-By0BNa38.js"),__vite__mapDeps([13,1,2,11,4,6,12,8]))),we=i.lazy(()=>m(()=>import("./Settings-Dx3rqj6w.js"),__vite__mapDeps([14,1,2,5,6,8]))),ve=i.lazy(()=>m(()=>import("./Documentation-DcHakhWo.js"),__vite__mapDeps([15,1,2,5,16,6,8]))),je=i.lazy(()=>m(()=>import("./KeyboardShortcuts-B6XWdC3d.js"),__vite__mapDeps([17,1,2,16,5,6,8]))),Ne=i.lazy(()=>m(()=>import("./ContactSupport-CHCplAUF.js"),__vite__mapDeps([18,1,2,5,16,6,8]))),Se=i.lazy(()=>m(()=>import("./PrivacySettings-BRLosjRT.js"),__vite__mapDeps([19,1,2,20,16,5,6,8]))),Ae=i.lazy(()=>m(()=>import("./NotificationSettings-DxkGw9oG.js"),__vite__mapDeps([21,1,2,20,16,5,6,8]))),_=()=>t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}),Ce=()=>(E(),t.jsx(q,{to:"/",replace:!0})),Ie=()=>{const[r,e]=i.useState("sheet-music"),[s,a]=i.useState(!1),{user:o,loading:l}=N();if(E(),l)return t.jsx(_,{});if(!o)return t.jsx(xe,{});const n=()=>{switch(r){case"sheet-music":return t.jsx(T,{},"sheet-music");case"dashboard":return t.jsx(be,{},"dashboard");case"calendar":return t.jsx(ye,{},"calendar");case"settings":return t.jsx(we,{onNavigate:e},"settings");case"documentation":return t.jsx(ve,{onNavigate:e},"documentation");case"keyboard-shortcuts":return t.jsx(je,{onNavigate:e},"keyboard-shortcuts");case"contact-support":return t.jsx(Ne,{onNavigate:e},"contact-support");case"privacy-settings":return t.jsx(Se,{onNavigate:e},"privacy-settings");case"notifications":return t.jsx(Ae,{onNavigate:e},"notifications");default:return t.jsx(T,{},"sheet-music-default")}};return t.jsx(pe,{currentPage:r,onNavigate:e,isSidebarExpanded:s,onSidebarExpandedChange:a,children:t.jsx(W,{mode:"wait",children:t.jsx(i.Suspense,{fallback:t.jsx(_,{}),children:n()})})})},Pe=()=>t.jsx(oe,{children:t.jsx(ce,{children:t.jsx(me,{children:t.jsx(le,{children:t.jsx(de,{children:t.jsxs(H,{children:[t.jsx(I,{path:"/auth/callback",element:t.jsx(Ce,{})}),t.jsx(I,{path:"*",element:t.jsx(Ie,{})})]})})})})})});j.createRoot(document.getElementById("root")).render(t.jsx(Q.StrictMode,{children:t.jsx(Y,{children:t.jsx(Pe,{})})}));export{A,he as D,b as a,N as b,ue as c,$e as d,$ as e,ke as f,De as u};
